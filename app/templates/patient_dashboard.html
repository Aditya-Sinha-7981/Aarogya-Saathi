<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Dashboard - Aarogya Saathi</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body class="dashboard-body">
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>üë§ Aarogya Saathi</h2>
            <button class="sidebar-toggle" id="sidebarClose" aria-label="Close sidebar">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <nav class="sidebar-nav">
            <a href="/patient/dashboard?view=overview" class="nav-item {% if view == 'overview' %}active{% endif %}">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Overview</span>
            </a>
            <a href="/patient/dashboard?view=search" class="nav-item {% if view == 'search' %}active{% endif %}">
                <span class="nav-icon">üîç</span>
                <span class="nav-text">Search Doctor</span>
            </a>
            <a href="/patient/dashboard?view=doctors" class="nav-item {% if view == 'doctors' %}active{% endif %}">
                <span class="nav-icon">üë•</span>
                <span class="nav-text">Doctors Visited</span>
            </a>
            <a href="/patient/dashboard?view=records" class="nav-item {% if view == 'records' %}active{% endif %}">
                <span class="nav-icon">üìã</span>
                <span class="nav-text">Medical Records</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar">{{ patient.email[0].upper() }}</div>
                <div class="user-details">
                    <p class="user-name">{{ patient.email }}</p>
                    <p class="user-role">Patient</p>
                </div>
            </div>
            <a href="/logout" class="btn btn-secondary btn-small btn-block">Logout</a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <header class="top-bar">
            <button class="hamburger" id="hamburger" aria-label="Toggle sidebar">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <h1 class="page-title">
                {% if view == 'overview' %}Dashboard Overview
                {% elif view == 'search' %}Search Doctor
                {% elif view == 'doctors' %}Doctors Visited
                {% elif view == 'records' %}Medical Records
                {% else %}Dashboard
                {% endif %}
            </h1>
        </header>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Overview View -->
            {% if view == 'overview' %}
            <div class="dashboard-overview">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìã</div>
                        <div class="stat-info">
                            <h3>{{ total_records }}</h3>
                            <p>Total Records</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üë®‚Äç‚öïÔ∏è</div>
                        <div class="stat-info">
                            <h3>{{ unique_doctors }}</h3>
                            <p>Doctors Visited</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-info">
                            <h3>{{ records|length }}</h3>
                            <p>Recent Records</p>
                        </div>
                    </div>
                </div>

                <div class="quick-actions">
                    <h2>Quick Actions</h2>
                    <div class="action-buttons">
                        <a href="/patient/dashboard?view=search" class="action-btn">
                            <span class="action-icon">üîç</span>
                            <span>Search Doctor</span>
                        </a>
                        <a href="/patient/dashboard?view=doctors" class="action-btn">
                            <span class="action-icon">üë•</span>
                            <span>View All Doctors</span>
                        </a>
                        <a href="/patient/dashboard?view=records" class="action-btn">
                            <span class="action-icon">üìã</span>
                            <span>View Medical Records</span>
                        </a>
                    </div>
                </div>

                <div class="recent-records">
                    <h2>Recent Medical Records</h2>
                    {% if records %}
                    <div class="records-list">
                        {% for record in records[:5] %}
                        <div class="record-card">
                            <div class="record-header">
                                <h3>{{ record.title }}</h3>
                                <span class="record-date">{{ record.created_at.strftime('%Y-%m-%d %H:%M') if record.created_at else 'N/A' }}</span>
                            </div>
                            <p class="record-patient"><strong>Doctor:</strong> {{ record.doctor_email }}</p>
                            <p class="record-notes">{{ (record.notes or "No notes provided.")[:100] }}{% if record.notes and record.notes|length > 100 %}...{% endif %}</p>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="empty-state">No medical records yet. Your doctor will add records here.</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Search View -->
            {% if view == 'search' %}
            <div class="search-section">
                <div class="search-box-container">
                    <form method="GET" action="/patient/dashboard" class="search-form">
                        <input type="hidden" name="view" value="search">
                        <div class="search-input-group">
                            <input 
                                type="text" 
                                name="q" 
                                class="search-input" 
                                placeholder="Search doctors by email..." 
                                value="{{ search_query }}"
                                autofocus
                            >
                            <button type="submit" class="search-btn">üîç Search</button>
                        </div>
                    </form>
                </div>

                {% if search_query %}
                <div class="search-results">
                    <h2>Search Results for "{{ search_query }}"</h2>
                    {% if search_results %}
                    <div class="patients-list">
                        {% for doctor in search_results %}
                        <div class="patient-card">
                            <div class="patient-info">
                                <div class="patient-avatar">{{ doctor.email[0].upper() }}</div>
                                <div class="patient-details">
                                    <h3>{{ doctor.email }}</h3>
                                    <p class="patient-meta">Doctor ID: {{ doctor.id }} | Joined: {{ doctor.created_at.strftime('%Y-%m-%d') if doctor.created_at else 'N/A' }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="empty-state">No doctors found matching "{{ search_query }}".</p>
                    {% endif %}
                </div>
                {% else %}
                <div class="search-placeholder">
                    <div class="placeholder-icon">üîç</div>
                    <h2>Search for Doctors</h2>
                    <p>Enter a doctor's email address to search for them in the system.</p>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- All Doctors View -->
            {% if view == 'doctors' %}
            <div class="patients-section">
                <div class="section-header">
                    <h2>Doctors Visited</h2>
                    <p class="section-subtitle">Total: {{ search_results|length }} doctors</p>
                </div>
                {% if search_results %}
                <div class="patients-list">
                    {% for doctor in search_results %}
                    <div class="patient-card">
                        <div class="patient-info">
                            <div class="patient-avatar">{{ doctor.email[0].upper() }}</div>
                            <div class="patient-details">
                                <h3>{{ doctor.email }}</h3>
                                <p class="patient-meta">Doctor ID: {{ doctor.id }} | Joined: {{ doctor.created_at.strftime('%Y-%m-%d') if doctor.created_at else 'N/A' }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="empty-state">No doctors found. You haven't visited any doctors yet.</p>
                {% endif %}
            </div>
            {% endif %}

            <!-- Records View -->
            {% if view == 'records' %}
            <div class="records-section">
                <div class="section-header">
                    <h2>Medical Records</h2>
                    <p class="section-subtitle">Total: {{ records|length }} records</p>
                </div>
                {% if records %}
                <div class="records-list">
                    {% for record in records %}
                    <div class="record-card">
                        <div class="record-header">
                            <h3>{{ record.title }}</h3>
                            <span class="record-date">{{ record.created_at.strftime('%Y-%m-%d %H:%M') if record.created_at else 'N/A' }}</span>
                        </div>
                        <p class="record-patient"><strong>Doctor:</strong> {{ record.doctor_email }}</p>
                        <div class="record-notes">
                            <strong>Notes:</strong>
                            <p>{{ record.notes or "No notes provided." }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="empty-state">No medical records yet. Your doctor will add records here.</p>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        // Hamburger menu toggle
        const hamburger = document.getElementById('hamburger');
        const sidebar = document.getElementById('sidebar');
        const sidebarClose = document.getElementById('sidebarClose');
        const mainContent = document.getElementById('mainContent');

        function toggleSidebar() {
            sidebar.classList.toggle('active');
            mainContent.classList.toggle('sidebar-open');
        }

        hamburger.addEventListener('click', toggleSidebar);
        sidebarClose.addEventListener('click', toggleSidebar);

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 768) {
                if (sidebar.classList.contains('active') && 
                    !sidebar.contains(e.target) && 
                    !hamburger.contains(e.target)) {
                    toggleSidebar();
                }
            }
        });
    </script>
</body>
</html>
